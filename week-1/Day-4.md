# Day 4: GLS, Blocking Vs Non-Blocking and Synthesis-Simulation mismatch

# 1. Introduction GLS, Blocking Vs Non-Blocking and Synthesis-Simulation mismatch
## 👉🏼 GLS Concept and Flow using in verilog
* GLS (Gate-Level Simulation) is a type of simulation performed after synthesis.
* Instead of simulating the RTL (behavioral Verilog), we simulate the gate-level netlist generated by the synthesis tool.
* This netlist contains logic gates, flip-flops, and interconnections from the technology library.
* GLS ensures that the design still works functionally after being mapped to real hardware gates.
  
## 👉🏼 Synthesis-Simulation Mismatch
When you run **RTL simulation**, the simulator executes behavioral Verilog-it follows the coding style you wrote.
But after synthesis, your design is **translated into gates** and **flip-flops**. Some RTL constructs don’t map cleanly to hardware, or they behave differently. This is where **mismatches** appear.

## 👉🏼 Blocking and Non-Blocking Statements in Verilog
| Aspect            | Blocking (=)                          | Non-Blocking (<=)                    |
|-------------------|----------------------------------------|---------------------------------------|
| Execution Order   | Executes statements sequentially       | Executes statements in parallel       |
| Typical Usage     | Combinational logic (`always @(*)`)    | Sequential logic (`always @(posedge clk)`) |
| Simulation Effect | Later statements see updated values    | All updates visible after time step   |

## 👉🏼 Caveats with Blocking Statements
- May cause **race conditions** in sequential logic.  
- Can lead to **RTL vs GLS mismatches**.  
- Creates **unintended dependencies** due to sequential execution.  

# 2. Lab:  GLS Synth Sim Mismatch
## 👉🏼 Lab 1: 
```bash
cd vlsi/sky130RTLDesignAndSynthesisWorkshop/verilog_files
iverilog ternary_operator_mux.v tb_ternary_operator_mux.v
./a.out
gtkwave tb_ternary_operator_mux.vcd
```
<img width="500" height="500" alt="image" src="https://github.com/user-attachments/assets/ebbf2a2d-705d-44b3-9601-2f8e1d8189b5" />

**Synthesis in Yosys**
```bash
yosys
read_liberty -lib ../lib/sky130_fd_sc_hd__tt_025C_1v80.lib
read_verilog ternary_operator_mux.v
synth -top ternary_operator_mux 
abc -liberty ../lib/sky130_fd_sc_hd__tt_025C_1v80.lib
write_verilog -noattr ternary_operator_mux_net.v
show -format png ternary_operator_mux
```
<img width="500" height="500" alt="image" src="https://github.com/user-attachments/assets/6d66a79a-43bf-4b86-bc40-80e82568bb79" />

**GLS**
```bash
iverilog ../my_lib/verilog_model/primitives.v ../my_lib/verilog_model/sky130_fd_sc_hd.v ternary_operator_mux_net.v tb_ternary_operator_mux.v
./a.out
gtkwave  tb_ternary_operator_mux.vcd
```
<img width="500" height="500" alt="image" src="https://github.com/user-attachments/assets/bc3e887f-2ff5-4478-97e3-21656eeae1b3" />

## 👉🏼 Lab 2: 
*Understand the mismatch behaviour*
```bash
cd vlsi/sky130RTLDesignAndSynthesisWorkshop/verilog_files
iverilog bad_mux.v tb_bad_mux.v
./a.out
gtkwave tb_bad_mux.vcd
```
<img width="800" height="600" alt="image" src="https://github.com/user-attachments/assets/0774d4aa-2e24-49bb-9243-e51e7a6b110c" />

*Synthesis in Yosys*
```bash
yosys
read_liberty -lib ../lib/sky130_fd_sc_hd__tt_025C_1v80.lib
read_verilog bad_mux.v
synth -top bad_mux 
abc -liberty ../lib/sky130_fd_sc_hd__tt_025C_1v80.lib
write_verilog -noattr bad_mux_net.v
show -format png bad_mux
```
<img width="400" height="400" alt="image" src="https://github.com/user-attachments/assets/ba587ff7-c73e-4daf-8d00-15ac7289239f" />


**GLS**
```bash
iverilog ../my_lib/verilog_model/primitives.v ../my_lib/verilog_model/sky130_fd_sc_hd.v bad_mux_net.v tb_bad_mux.v
./a.out
gtkwave  tb_bad_mux.vcd
```
<img width="500" height="500" alt="image" src="https://github.com/user-attachments/assets/a593ec70-bdd2-4368-ba32-6357ea70fbec" />

# 3. Lab: GLS Synth Sim Mismatch blocking statement
```bash
cd vlsi/sky130RTLDesignAndSynthesisWorkshop/verilog_files
iverilog blocking_caveat.v tb_blocking_caveat.v
./a.out
gtkwave tb_blocking_caveat.vcd
```
<img width="500" height="500" alt="image" src="https://github.com/user-attachments/assets/d6d22167-d27f-4c88-837e-ae9ec3ab125e" />

*Synthesis in Yosys*
```bash
yosys
read_liberty -lib ../lib/sky130_fd_sc_hd__tt_025C_1v80.lib
read_verilog blocking_caveat.v
synth -top blocking_caveat
abc -liberty ../lib/sky130_fd_sc_hd__tt_025C_1v80.lib
write_verilog -noattr blocking_caveat_net.v
show -format png blocking_caveat
```
<img width="500" height="500" alt="image" src="https://github.com/user-attachments/assets/d4aab0d8-a31e-42ef-a4b3-1e13e7755b9e" />

**GLS**
```bash
iverilog ../my_lib/verilog_model/primitives.v ../my_lib/verilog_model/sky130_fd_sc_hd.v blocking_caveat_net.v tb_blocking_caveat.v
./a.out
gtkwave tb_blocking_caveat.vcd
```
<img width="500" height="500" alt="image" src="https://github.com/user-attachments/assets/3d76cb2d-b67b-4fde-af42-683359b75b18" />


<p align="center">
  🔹 End of Lab 🔹
</p>

